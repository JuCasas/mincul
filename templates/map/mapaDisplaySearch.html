{% load static %}

{% block extrastyle %}
    <link href="../static/lib/flatpickr/flatpickr.min.css" rel="stylesheet">
    <link href="../static/lib/raty-js/jquery.raty.css" rel="stylesheet">

    <link href="../static/lib/leaflet/leaflet.css" rel="stylesheet">
    <link href="../static/lib/leaflet.markercluster/MarkerCluster.css" rel="stylesheet">
    <link href="../static/lib/leaflet.markercluster/MarkerCluster.Default.css" rel="stylesheet">
    <style></style>
{% endblock %}

{% block extrahead %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"/>
    <!-- Crea la ruta -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css"/>
{% endblock %}

{% block body%}
<div class="card" style="width: 100%">
    <div class="position-relative">
        <div id="map" style="height: 75vh; object-fit: cover; border-radius: 3px"></div>
    </div>
</div>
{% endblock %}

{% block extrajs %}
<script src="../static/lib/flatpickr/flatpickr.min.js"></script>
    <script src="{% static 'lib/raty-js/jquery.raty.js' %}"></script>

    <script src="../static/lib/leaflet/leaflet.js"></script>
    <script src="../static/lib/leaflet.markercluster/leaflet.markercluster.js"></script>
    <script src="../static/lib/leaflet.tilelayer.colorfilter/leaflet-tilelayer-colorfilter.min.js"></script>

    <!-- leaflet js cdn -->
    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>
    <!-- ruta entre puntos -->
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
    <script>
        // leaflet map with osm tilelayer
        var map = L.map('map').setView([-9.40, -75.00], 5);
        var tileLayer = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {attribution: "OSM"}).addTo(map);

        var myIcon = L.icon({
            iconUrl: '../static/lib/leaflet/images/marker-icon.png',
            iconSize: [15, 40],
            iconAnchor: [15,40],
            popupAnchor: [-1,-39]
        });

        {% if patrimony %}
            $(document).ready(function () {
            $.ajax({
                type: "POST",
                url: 'punto/{{ patrimony.id }}',
                data: {
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                },
                success: function (data) {
                    let markerInicio = L.marker([data.patrimonio.lat,data.patrimonio.long], {
                        icon:myIcon,
                        title:data.patrimonio.nombreTituloDenominacion
                    }).addTo(map).bindPopup("<div>" +
                        "<p>" + data.patrimonio.nombreTituloDenominacion +"</p>" +
                        "<img width='300' src='../static/img/generic/ciudadela-1.png'/>" +
                    "</div>")
                    map.flyTo([data.patrimonio.lat,data.patrimonio.long],14);
                }
            });
        });
        {% endif %}
    </script>
{% endblock %}