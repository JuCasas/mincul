{% extends 'base/base.html' %}
{% load static %}

{% block extrastyle %}
    <link href="{% static 'lib/flatpickr/flatpickr.min.css' %}" rel="stylesheet">
    <link href="../../static/lib/raty-js/jquery.raty.css" rel="stylesheet">
    <style>
        .second {
          background-color: white !important;
          color: #2B2D42 !important;
          border-color: #8d8e99 !important;
          border-radius: 12px !important;
          height: 36px !important;
          font-size: 12px !important;
      }
    </style>
{% endblock %}

{% block body %}

    <div class="col-12">
        <div class="card mb-3 bg-card-gradient">
            <div class="card-body ">
                <div class="row justify-content-between align-items-center">
                    <div class="col-md">
                        <h5 class="mb-2 mb-md-0 text-white">Ministerio de Cultura</h5>
                    </div>
                </div>
            </div>
        </div>

        <!--Cabecera card imagen-->
        <div class="card rounded-3">
            <div class="card" style="width: 100%;">
                <div class="position-relative">
                    <div>
                        <img class="img-fluid w-100"
                             style="height: 320px; object-fit: fill; border-radius: 3px"
                                {#                                         src="../static/img/generic/4-caral.jpg"#}
                             src={{ valor.url }}
                             alt="Card image"/>
                    </div>
                    <div class="card-img-overlay d-flex align-items-end text-white pb-2">
                        <p class="card-text "
                           style="font-size: 25px;font-weight: bold; text-shadow : 1px 1px black;">{{ valor.nombreTituloDemoninacion }}
                            </p>
                        <div class="col text-right">
                            {% if puntacion >= 1 %}
                                <span class="fa fa-star" style="color: gold; text-shadow: 1px 1px black;"></span>
                                {% else %}
                                <span class="fa fa-star"></span>
                            {% endif %}
                            {% if puntacion >= 2 %}
                                <span class="fa fa-star" style="color: gold; text-shadow: 1px 1px black;"></span>
                                {% else %}
                                <span class="fa fa-star"></span>
                            {% endif %}
                            {% if puntacion >= 3 %}
                                <span class="fa fa-star" style="color: gold; text-shadow: 1px 1px black;"></span>
                                {% else %}
                                <span class="fa fa-star"></span>
                            {% endif %}
                            {% if puntacion >= 4 %}
                                <span class="fa fa-star" style="color: gold; text-shadow: 1px 1px black;"></span>
                                {% else %}
                                <span class="fa fa-star"></span>
                            {% endif %}
                            {% if puntacion >= 5 %}
                                <span class="fa fa-star" style="color: gold; text-shadow: 1px 1px black;"></span>
                                {% else %}
                                <span class="fa fa-star"></span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--Cabecera card imagen fin-->

        <!-- Info de patrimonio -->
        <div class="row mt-4">
            <div class="col-8">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md">
                                <h5 class="card-title text-black">Historia:</h5>
                                <p class="mb-2 mb-md-0 text-black">
                                    Se ubica en la provincia de Barranca, Región Lima. Constituye la manifestación más
                                    antigua de la civilización en el Perú y en el continente americano debido a sus 5000
                                    años de antigüedad. Está conformada por 32 edificios monumentales, comprendidos en
                                    un complejo sistema de asentamientos que muestran una fuerte ideología religiosa,
                                    entre los cuales se distinguen edificios ceremoniales, sectores residenciales para
                                    gente de alto ranfo social, un conjunto de templos menores y talleres para la
                                    producción. Caral lideró un sistema de asentamientos que congregó 17 sitios
                                    similares,
                                    aunque más pequeños, ubicados en el valle de Supe. Expresa la complejidad y el
                                    desarrollo de un modelo de organización socio político y económico temprano durante
                                    el Período Arcaico tardío (5000 - 3800 BP) originado de manera independiente por las
                                    sociedades andinas que habitaron este pequeño valle fértil de la costa central
                                    peruana.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-4">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md">
                                <h5 class="card-title text-black">Datos de identificación:</h5>
                                <h6 class="mb-2 mb-md-0 text-black">Categoría: Arquitectura arcaica</h6>
                                <p></p>
                                <h6 class="mb-2 mb-md-0 text-black">Tipo de Bien: Inmueble</h6>
                                <p></p>
                                <h6 class="mb-2 mb-md-0 text-black">Título/Denominación: La Ciudad Sagrada Caral</h6>
                                <p></p>
                                <h6 class="mb-2 mb-md-0 text-black">Autor: --</h6>
                                <p></p>
                                <h6 class="mb-2 mb-md-0 text-black">Firmada: --</h6>
                                <p></p>
                                <h6 class="mb-2 mb-md-0 text-black">Lugar de Manufactura: --</h6>
                                <p></p>
                                <h6 class="mb-2 mb-md-0 text-black">Estilo: --</h6>
                                <p></p>
                                <h6 class="mb-2 mb-md-0 text-black">Datación: 3000 a.c. - Periodo arcaico tardío</h6>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info de patrimonio fin-->

        <div class="row mt-4">
            <div class="col-8">
                <div class="col-sm-12 col-lg-12 px-0">
                    <div class="card bg-light">
                      <div class="card-body">
                        <div class="card-title">Valoraciones</div>
                          {% for v in valoraciones %}
                              <div class="row">
                                <div class="col-4">
                                    <p>{{ v.nombre }}</p>
                                </div>
                                  <div class="col-8 pb-3">
                                      {% if v.valoracion >= 1 %}
                                        <span class="fa fa-star" style="color: gold; text-shadow: 1px 1px black;"></span>
                                        {% else %}
                                        <span class="fa fa-star"></span>
                                    {% endif %}
                                    {% if v.valoracion >= 2 %}
                                        <span class="fa fa-star" style="color: gold; text-shadow: 1px 1px black;"></span>
                                        {% else %}
                                        <span class="fa fa-star"></span>
                                    {% endif %}
                                    {% if v.valoracion >= 3 %}
                                        <span class="fa fa-star" style="color: gold; text-shadow: 1px 1px black;"></span>
                                        {% else %}
                                        <span class="fa fa-star"></span>
                                    {% endif %}
                                    {% if v.valoracion >= 4 %}
                                        <span class="fa fa-star" style="color: gold; text-shadow: 1px 1px black;"></span>
                                        {% else %}
                                        <span class="fa fa-star"></span>
                                    {% endif %}
                                    {% if v.valoracion >= 5 %}
                                        <span class="fa fa-star" style="color: gold; text-shadow: 1px 1px black;"></span>
                                        {% else %}
                                        <span class="fa fa-star"></span>
                                    {% endif %}
                                  </div>
                              <div class="card-text pl-3 mb-4 font-italic">{{ v.comentario }}</div>
                              </div>
                          {% endfor %}
                      </div>
                    </div>
                  </div>
                </div>

            <div class="col-4">
                <div class="card">
                        <div class="card-body">
                            <h5 class="card-title text-black">Registar Incidente</h5>

                            <form id="incidente_form" method="post" action="" enctype="multipart/form-data">
                                {% csrf_token %}
                                <label for="tipo">Seleccione el tipo de afectación:</label>
                                <select class="form-control" id="tipoAfectacion" name="tipo"
                                        data-placeholder='Tipo de afectación'>
                                  {% for a in afectaciones %}
                                    <option data="{{ a }}" value={{ a }}>{{ a }}</option>
                                  {% endfor %}
                                </select>

                                <label for="fecha">¿Cuándo sucedió el hecho?</label>
                                <input type="date" name="fecha" class="form-control">

                                <label for="descripcion">Descripción:</label>
                                <textarea name="descripcion" class="form-control" style="height: 8em" placeholder="Descripción..."></textarea>

                                <label for="descripcion">Evidencia: peso máximo 50 mb</label>

                                <input type="file" id="actual-btn" hidden multiple/>

                                <label for="actual-btn" class="btn btn-primary mr-1 mb-1 form-control" type="button">Adjuntar Archivos</label>
                                <span id="file-chosen-0" class="form-control">No se eligió ningún archivo</span>
                                <span id="file-chosen-1" class="form-control" hidden></span>
                                <span id="file-chosen-2" class="form-control" hidden></span>
                                <script>
                                    const actualBtn = document.getElementById('actual-btn');
                                    actualBtn.addEventListener('change', function(){
                                        console.log(actualBtn.files)
                                        console.log(actualBtn.files.length)
                                        for(var i=1; i<3; i++){
                                            const fileChosen  = document.getElementById('file-chosen-' + i);
                                            fileChosen.hidden = true;
                                        }
                                        for(var i=0; i<actualBtn.files.length; i++){
                                            const fileChosen  = document.getElementById('file-chosen-' + i);
                                            fileChosen.textContent = this.files[i].name;
                                            fileChosen.hidden = false;
                                        }
                                    })
                                </script>

                                <label for="nombre">¿Cómo te llamas?</label>
                                <input name="nombre" class="form-control" placeholder="Nombre y Apellido...">

                                <label for="email">¿Cual es tu correo electrónico?</label>
                                <input name="email" class="form-control" placeholder="Correo electrónico...">

                                <label for="telefono">¿Cual es tu teléfono?</label>
                                <input name="telefono" class="form-control" placeholder="Teléfono...">
                            </form>

                            <button class="btn btn-dark mt-4 mr-1 mb-1 w-100" type="submit" form="incidente_form" name="accion" value="incidente">Registar Incidente</button>
                        </div>
                </div>


                    <div class="card mt-4">
                        <div class="card-body">
                            <h5 class="card-title text-black">Valora la ciudad sagrada de Caral:</h5>
                            <form class="form-validation" method="post">
                                {% csrf_token %}
                              <div class="form-group">
                                <label for="form-name">Name*</label>
                                <input class="form-control" type="text" name="name" placeholder="Nombre y Apellido..." required id="form-name">
                              </div>
                              <div class="form-group">
                                <label for="form-email">¿Cual es tu correo electrónico?:</label>
                                <input class="form-control" type="email" name="email" placeholder="Correo electrónico..." required id="form-email">
                              </div>
                              <div class="form-group">
                                <label for="contact-form-message">Cuentanos tu experiencia:*</label>
                                <textarea class="form-control" rows="3" required id="contact-form-message" name="comment"></textarea>
                              </div>
                              <div class="form-group">
                                 <div class="row pl-3 pt-lg-3">
                                    <div class="pt-1 mr-3">
                                        <label for="value">Puntuación</label>
                                    </div>
                                    <div class="raty" id="raty" onclick="lessThan2Stars()"></div>
                                 </div>
                              </div>
                              <button class="btn btn-primary btn-block" type="submit" id="ratySubmit" onclick="validar()">Guardar</button>
                            </form>
                        </div>
                    </div>
            </div>

        </div>

    <!-- Incident Modal -->
  <div class="modal fade px-1" id="incidentModal" role="dialog" oncancel="closeModal()">
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header justify-content-center">
          <h4 class="card-title text-black mb-0">Registar Incidente</h4>
        </div>
        <div class="modal-body">
          <form id="incidente_form" method="post" action="" enctype="multipart/form-data">
                                {% csrf_token %}
                                <label for="tipo">Seleccione el tipo de afectación:</label>
                                <select class="form-control" id="tipoAfectacion" name="tipo"
                                        data-placeholder='Tipo de afectación'>
                                  {% for a in afectaciones %}
                                    <option data="{{ a }}" value={{ a }}>{{ a }}</option>
                                  {% endfor %}
                                </select>

                                <label for="fecha">¿Cuándo sucedió el hecho?</label>
                                <input type="date" name="fecha" class="form-control">

                                <label for="descripcion">Descripción:</label>
                                <textarea name="descripcion" class="form-control" style="height: 8em" placeholder="Descripción..."></textarea>

                                <label for="descripcion">Evidencia: peso máximo 50 mb</label>

                                <input type="file" id="actual-btn" hidden multiple/>

                                <label for="actual-btn" class="btn btn-primary mr-1 mb-1 form-control d-flex align-items-center justify-content-center" type="button">Adjuntar Archivos</label>
                                <span id="file-chosen-0" class="form-control d-flex align-items-center justify-content-center">No se eligió ningún archivo</span>
                                <span id="file-chosen-1" class="form-control" hidden></span>
                                <span id="file-chosen-2" class="form-control" hidden></span>
                                <script>
                                    const actualBtn = document.getElementById('actual-btn');
                                    actualBtn.addEventListener('change', function(){
                                        console.log(actualBtn.files)
                                        console.log(actualBtn.files.length)
                                        for(var i=1; i<3; i++){
                                            const fileChosen  = document.getElementById('file-chosen-' + i);
                                            fileChosen.hidden = true;
                                        }
                                        for(var i=0; i<actualBtn.files.length; i++){
                                            const fileChosen  = document.getElementById('file-chosen-' + i);
                                            fileChosen.textContent = this.files[i].name;
                                            fileChosen.hidden = false;
                                        }
                                    })
                                </script>

                                <label for="nombre">¿Cómo te llamas?</label>
                                <input name="nombre" class="form-control" placeholder="Nombre y Apellido...">

                                <label for="email">¿Cual es tu correo electrónico?</label>
                                <input name="email" class="form-control" placeholder="Correo electrónico...">

                                <label for="telefono">¿Cual es tu teléfono?</label>
                                <input name="telefono" class="form-control" placeholder="Teléfono...">
                            </form>
        <div class="row justify-content-between m-0 mt-3">
            <button type="button" data-dismiss="modal" class="btn second col-5">Cancelar</button>
            <button class="btn btn-primary col-5" type="submit" form="incidente_form" name="accion" value="incidente">Registar Incidente</button>
          </div>

        </div>
      </div>
    </div>
  </div>


    </div>


{% endblock %}

{% block extrajs %}
    <script src="{% static 'lib/flatpickr/flatpickr.min.js' %}"></script>
    <script src="../../static/lib/raty-js/jquery.raty.js"></script>
    <script src="{% static 'lib/datatables-1.10.20/js/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'lib/datatables/js/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'lib/datatables-bs4/dataTables.bootstrap4.min.js' %}"></script>
    <script src="{% static 'lib/owl.carousel/owl.carousel.js' %}"></script>
    <script src="{% static 'lib/jquery-validation/jquery.validate.min.js' %}"></script>
    <script>

        function validar(){
            let val =  $("input[name*='score']");
            let err = $("#errorv");
            if (val.val()==''){
                val.val(0)
                err.text("Se debe ingresar una validación")
            }
            else{
                err.text(" ")
            }
            console.log(val.val())
            console.log(err.text())
        }

        $(document).ready(function () {
            $("form[id='valoracion_form']").validate({
            rules: {
                name: {
                    required: true,
                },
                email: {
                    required: true,
                    email: true,
                },
                comment: {
                    required: true,
                },
                score: {
                    required: true,
                },
            },
            messages: {
                name: {
                    required: "Debe ingresar su nombre",
                },
                email: {
                    required: "Debe ingresar su correo electrónico",
                    email: "Debe ingresar un formato de correo válido"
                },
                comment: {
                    required: "Debe ingresar un comentario válido",
                },
                score: {
                    required: "Debe ingresar una puntuación",
                },
            },
            submitHandler: function (form, e) {
                e.preventDefault();
                if ($("#formAddEntidades").valid()) {
                    form.submit();
                }
                return false;
            }
        });

            $('#incidentesLista').DataTable({
                dom: "<'d-flex justify-content-end pb-4'B>\n" +
                    "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>\n" +
                    "<'table-responsive'tr>\n" +
                    "<'row align-items-center'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7 d-flex justify-content-end'p>>",
                language: {
                    processing: "Procesando...",
                    lengthMenu: "Mostrar  _MENU_  incidentes",
                    zeroRecords: "No se encontraron incidentes",
                    emptyTable: "No existen incidentes registrados",
                    info: "Mostrando incidentes del _START_ al _END_ <br>Total _TOTAL_ incidentes",
                    infoEmpty: "Mostrando incidentes del 0 al 0 <br>Total 0 incidentes",
                    infoFiltered: "(filtrado de un total de _MAX_ incidentes)",
                    loadingRecords: "Cargando...",
                    search: "Buscar:",
                    paginate: {
                        previous: '<i class="fa fa-lg fa-angle-left mr-2"></i>Anterior',
                        next: 'Siguiente<i class="fa fa-lg fa-angle-right ml-2"></i>'
                    }
                },
                autoWidth: false,
                lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "Todos"]],
                buttons: []
            });
        });

        function lessThan2Stars(){
            if($('#raty').raty('score') <= 2){
                $("#incidentModal").modal();
                $("#ratySubmit").attr("disabled", true);
            }
            else{
                $("#ratySubmit").removeAttr("disabled");
            }
        }

        $('#incidentModal').on('hidden.bs.modal', function (e) {
            if($('#raty').raty('score') <= 2){
                $('#raty').raty('reload');
                $("#ratySubmit").removeAttr("disabled");
            }
        })

    </script>
{% endblock %}